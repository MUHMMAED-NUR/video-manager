<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù…Ø¯ÙŠØ± Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ â€” Ù…ØªØ²Ø§Ù…Ù†</title>
<style>
/* ğŸ¨ ØªÙ… ØªØ±Ùƒ ÙƒÙˆØ¯ CSS ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø®ÙŠØ± (Ø§Ù„Ø£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ù‹Ø§) */
:root{--bg:#f3f3f3;--card:#fafafa;--accent:#007bff;--note:#e6e6e6;--text:#111;--color-rec:#4CAF50;--color-rej:#F44336;--light-rec:#e6ffef;--light-rej:#ffecec}
body{font-family:Arial;margin:0;padding:18px;background:var(--bg);color:var(--text)}
.header{display:flex;justify-content:flex-end;gap:10px;align-items:center}
.btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;transition:background-color 0.3s ease}
.btn:hover{background:#0056b3}
.container{background:#fff;padding:18px;border-radius:12px;margin-top:14px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
h2{font-size: 28px; margin-bottom: 15px;}
.section-title{font-size:24px;margin-bottom:10px; font-weight: bold;}
.input-row{display:flex;gap:10px;margin-bottom:12px}
.input-row input, .input-row textarea{flex:1;padding:10px;border:1px solid #ddd;border-radius:8px}
.video-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(420px,1fr));gap:12px}
.video-card{
    background:var(--card);
    padding:12px;
    padding-top: 40px;
    border-radius:10px;
    display:flex;
    gap:12px;
    align-items:center;
    position:relative;
    transition: all 0.3s ease;
    border: 1px solid #ddd;
}
.video-card-status-recorded{background: var(--light-rec);border: 1px solid var(--color-rec);}
.video-card-status-rejected{background: var(--light-rej);border: 1px solid var(--color-rej);}
.video-card img{width:170px;height:96px;object-fit:cover;border-radius:8px}
.note-box{background:var(--note);padding:8px;border-radius:8px;margin-top:6px}
.play-btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;border:1px solid #ddd;cursor:pointer;text-decoration:none}
.play-icon{width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent;border-left:16px solid #ff4d4d}
.status-label{
    position:absolute;top:0;left:0;right:0;width: 100%;padding:8px 10px;border-radius:10px 10px 0 0; 
    font-size: 16px;font-weight:700;display:none;z-index: 10;text-align: center; box-sizing: border-box; 
    border-bottom: 1px solid transparent; 
}
.status-recorded{background:#d5f3d5;color:#0a7b3f;border-color: var(--color-rec);display:block}
.status-rejected{background:#fdd5d5;color:#c12b2b;border-color: var(--color-rej);display:block}
.status-controls{display:flex;flex-direction:column;gap:8px}
.status-controls button{padding:8px 10px;border-radius:8px;border:none;color:#fff;font-weight:bold;cursor:pointer;transition: background-color 0.3s ease, transform 0.1s;}
.status-controls .btn-rec{background:#4CAF50;}
.status-controls .btn-rej{background:#F44336;}
.status-controls button:hover{opacity: 0.9;transform: translateY(-1px);}
.delete-btn{position:absolute;top:8px;right:8px;background:#ff3b3b;color:#fff;border:none;border-radius:6px;padding:4px 8px;cursor:pointer;transition:background-color 0.3s ease}
.delete-btn:hover{background:#cc0000}
.small-note{
    font-size:18px; font-weight: bold; color:#111; margin-top: 15px; display: block; 
}
.night{background:#111;color:#ddd}
.night .container{background:#1b1b1b}
.night .video-card{background:#151515}
.night .note-box{background:#2a2a2a;color:#ddd}
.night .input-row input{background:#111;color:#ddd;border:1px solid #333}
.night #textIdeaList li{border-bottom:1px solid #333}
.night .small-note{color:#fff;}
#textIdeaList{list-style:none;padding:0}
#textIdeaList li{border-bottom:1px solid #eee;padding:10px 0}
</style>

<!-- ğŸš€ ØªØ¶Ù…ÙŠÙ† Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

</head>
<body id="appBody" style="display: none;"> <!-- Ø¬Ø¹Ù„ Ø§Ù„Ø¬Ø³Ù… Ù…Ø®ÙÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->

<div class="header">
  <label class="small-note">ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ</label>
  <button class="btn" onclick="toggleNight()">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ÙŠÙ„</button>
</div>

<h2>ğŸ“ Ù…Ø¯ÙŠØ± Ø­ÙØ¸ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ â€” Ù…ØªØ²Ø§Ù…Ù† (Firebase)</h2>

<div class="container">
  <div class="section-title">ğŸ¥ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø©</div>
  <div class="input-row">
    <button class="btn" onclick="saveVideo('long')">Ø­ÙØ¸</button>
    <input id="longLink" placeholder="Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù‡Ù†Ø§">
    <input id="longNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  </div>
  <div id="longList" class="video-grid"></div>
</div>

<div class="container">
  <div class="section-title">ğŸ¬ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø©</div>

  <div class="small-note">ğŸŸ£ Ø±Ø¯Ø© ÙØ¹Ù„</div>
  <div class="input-row">
    <button class="btn" onclick="saveVideo('react')">Ø­ÙØ¸</button>
    <input id="shortReact" placeholder="Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ Ø±Ø¯Ø© ÙØ¹Ù„">
    <input id="shortReactNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  </div>
  <div id="reactList" class="video-grid"></div>

  <div class="small-note">ğŸŸ¢ ØªÙ…Ø«ÙŠÙ„</div>
  <div class="input-row">
    <button class="btn" onclick="saveVideo('act')">Ø­ÙØ¸</button>
    <input id="shortAct" placeholder="Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ ØªÙ…Ø«ÙŠÙ„">
    <input id="shortActNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  </div>
  <div id="actList" class="video-grid"></div>

  <div class="small-note">ğŸ”µ ÙÙƒØ±Ø©</div>
  <div class="input-row">
    <button class="btn" onclick="saveVideo('idea')">Ø­ÙØ¸</button>
    <input id="shortIdea" placeholder="Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ ÙÙƒØ±Ø©">
    <input id="shortIdeaNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  </div>
  <div id="ideaList" class="video-grid"></div>
</div>

<div class="container">
  <div class="section-title">ğŸ“ Ø£ÙÙƒØ§Ø± Ù†ØµÙŠØ©</div>
  <div class="input-row">
    <input id="textIdea" placeholder="Ø§ÙƒØªØ¨ ÙÙƒØ±Ø© Ù‡Ù†Ø§">
    <button class="btn" onclick="saveTextIdea()">Ø­ÙØ¸</button>
  </div>
  <ul id="textIdeaList"></ul>
</div>

<script>
// ==============================================
// 1. Ø¥Ø¹Ø¯Ø§Ø¯ Firebase (Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ØªÙ… Ù„ØµÙ‚Ù‡Ø§ Ù‡Ù†Ø§)
// ==============================================

const firebaseConfig = {
    apiKey: "AIzaSyA4GCJfuEBCoiaD2h3BSiZzAq4vK2wTVPE",
    authDomain: "videomanagerapp-bdcbf.firebaseapp.com",
    databaseURL: "https://videomanagerapp-bdcbf-default-rtdb.europe-west1.firebasedatabase.app", 
    projectId: "videomanagerapp-bdcbf",
    storageBucket: "videomanagerapp-bdcbf.firebasestorage.app",
    messagingSenderId: "505800131782",
    appId: "1:505800131782:web:0351d4f2642c40376983c7",
    measurementId: "G-N6VJBGS11F"
};

// ØªÙ‡ÙŠØ¦Ø© Firebase ÙˆØªØ¹ÙŠÙŠÙ† Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
// 'user_data' Ù‡Ùˆ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠÙ‡ Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ
const dbRef = db.ref('user_data'); 

let allData = {}; // Ù…ØªØºÙŠÙ‘Ø± Ø¹Ø§Ù… Ù„Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
let textIdeas = []; // Ù…ØªØºÙŠÙ‘Ø± Ø¹Ø§Ù… Ù„Ø­ÙØ¸ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ù†ØµÙŠØ©

// ==============================================
// 2. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙˆØ§Ù„Ø­ÙØ¸ (Ø§Ù„Ø¢Ù† Ù…Ø¹ Firebase)
// ==============================================

// Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
async function loadDataFromFirebase() {
    try {
        // Ù†Ø³ØªØ®Ø¯Ù… .once('value') Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const snapshot = await dbRef.once('value');
        const data = snapshot.val();
        
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        if (data && data.videos) {
            // Ù†Ø³ØªØ®Ø¯Ù… Object.values().filter(Boolean) Ù„Ø¶Ù…Ø§Ù† Ø£Ù†Ù†Ø§ Ù†ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù…ØµÙÙˆÙØ§Øª Ø³Ù„ÙŠÙ…Ø©
            allData = Object.keys(data.videos).reduce((acc, key) => {
                acc[key] = data.videos[key] ? Object.values(data.videos[key]).filter(Boolean) : [];
                return acc;
            }, {});
        } else {
            allData = {};
        }
        if (data && data.ideas && Array.isArray(data.ideas)) {
            textIdeas = data.ideas;
        } else {
            textIdeas = [];
        }

    } catch (error) {
        console.error("Error loading data from Firebase:", error);
        // Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… alert() Ù‡Ù†Ø§ Ù„ØªØ¬Ù†Ø¨ Ø¥ÙŠÙ‚Ø§Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        console.warn("ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†.");
    }
}

// Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Firebase
function saveAllToFirebase() {
    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ÙØ¸ ÙÙŠ Firebase
    const dataToSave = {
        videos: allData,
        ideas: textIdeas
    };
    dbRef.set(dataToSave).catch(error => {
        console.error("Error saving data to Firebase:", error);
    });
}

// ==============================================
// 3. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ§Ù„ØªÙ‡ÙŠØ¦Ø©
// ==============================================

function showCustomAlert(message) {
    // Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… alert() ÙˆÙ„ÙƒÙ† Ù†Ø³ØªØ®Ø¯Ù… console.log() Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„
    console.log("Alert Message:", message);
    // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ù‡Ù†Ø§ Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù…Ø®ØµØµØ© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª
}

function checkPassword() {
    const correctPassword = "963507";
    let inputPassword = prompt("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ø¯ÙŠØ± Ø§Ù„Ø±ÙˆØ§Ø¨Ø·:");

    if (inputPassword === correctPassword) {
        document.getElementById('appBody').style.display = 'block'; 
        init(); // Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
    } else {
        showCustomAlert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„.");
        document.body.innerHTML = '<h1>ğŸš« ÙˆØµÙˆÙ„ Ù…Ø±ÙÙˆØ¶.</h1>';
    }
}

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØªØ¨Ø¯Ø£ Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
async function init() {
    await loadDataFromFirebase(); // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ (ÙŠØ³ØªÙ…Ø± ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ)
    if (localStorage.getItem('nightMode') === 'true') {
        document.body.classList.add('night');
    }
    
    // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    renderAll();
}

// ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.onload = checkPassword;

// ==============================================
// 4. Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ÙØ¹Ø¯Ù‘ÙÙ„Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
// ==============================================

// --- Helpers ---
function extractVideoId(url){
  const patterns=[/v=([^&]+)/,/youtu.be\/([^?&]+)/,/embed\/([^?&]+)/,/shorts\/([^?&]+)/];
  for(const p of patterns){const m=url.match(p); if(m) return m[1];}
  return null;
}
async function fetchVideoData(videoId){
  try{const res=await fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${videoId}`); if(!res.ok) return null; return await res.json();}catch{return null}
}
function genId(){return 'v_'+Date.now()+'_'+Math.floor(Math.random()*1000)}


// --- Render ---
function renderCard(video,type){
  const container=document.getElementById(type+'List');
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù„ØªØ¬Ù†Ø¨ Ø¥Ø¶Ø§ÙØ© Ù†ÙØ³ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ø±ØªÙŠÙ†
  if (document.querySelector(`.video-card[data-id="${video.id}"]`)) return;

  const card=document.createElement('div');
  card.className='video-card';
  card.setAttribute('data-id',video.id);

  if(video.recorded) {
    card.classList.add('video-card-status-recorded');
  } else if(video.rejected) {
    card.classList.add('video-card-status-rejected');
  }

  const del=document.createElement('button');
  del.className='delete-btn';
  del.textContent='X';
  del.onclick=()=>deleteVideo(video.id);
  card.appendChild(del);

  const statusLabel=document.createElement('div');
  statusLabel.className='status-label';
  if(video.rejected){statusLabel.classList.add('status-rejected'); statusLabel.textContent='Ù…Ø±ÙÙˆØ¶'}
  else if(video.recorded){statusLabel.classList.add('status-recorded'); statusLabel.textContent='ØªÙ… Ø§Ù„ØªØµÙˆÙŠØ±'}
  card.appendChild(statusLabel);

  const img=document.createElement('img'); img.src=video.thumbnail;
  img.onerror = function() { this.src = 'https://placehold.co/170x96/cccccc/000000?text=No+Image'; }; // Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø¨Ø¯ÙŠÙ„Ø©
  const info=document.createElement('div');
  info.innerHTML=`<h4 style="margin:0 0 6px">${video.title}</h4>
    <div class='note-box'>${video.note||'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø©'}</div>
    <div style='margin-top:8px'><a class='play-btn' href='${video.url}' target='_blank'><span class='play-icon'></span><span>ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</span></a></div>`;

  const controls=document.createElement('div'); controls.className='status-controls';
  const btnRec=document.createElement('button'); btnRec.className='btn-rec'; btnRec.textContent='âœ“ ØªØµÙˆÙŠØ±'; btnRec.onclick=()=>toggleRecorded(video.id);
  const btnRej=document.createElement('button'); btnRej.className='btn-rej'; btnRej.textContent='âœ• Ø±ÙØ¶'; btnRej.onclick=()=>toggleRejected(video.id);
  controls.appendChild(btnRec); controls.appendChild(btnRej);

  card.appendChild(img); card.appendChild(info); card.appendChild(controls);
  container.appendChild(card);
}

function clearAllRender(){['long','react','act','idea'].forEach(t=>document.getElementById(t+'List').innerHTML='')}
function renderAll(){
    clearAllRender(); 
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù… allData
    for(const t of Object.keys(allData)){
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† allData[t] Ù…ØµÙÙˆÙØ© Ù‚Ø¨Ù„ Ø§Ù„ØªÙƒØ±Ø§Ø±
        if (Array.isArray(allData[t])) {
            allData[t].forEach(v=>renderCard(v,t))
        }
    } 
    renderTextIdeas();
}

// --- Save video ---
async function saveVideo(type){
  let linkId, noteId;
  if (type === 'long') {
    linkId = 'longLink';
    noteId = 'longNote';
  } else if (type === 'react') {
    linkId = 'shortReact';
    noteId = 'shortReactNote';
  } else if (type === 'act') {
    linkId = 'shortAct';
    noteId = 'shortActNote';
  } else if (type === 'idea') {
    linkId = 'shortIdea';
    noteId = 'shortIdeaNote';
  } else {
    return;
  }
  
  const linkEl = document.getElementById(linkId);
  const noteEl = document.getElementById(noteId);
  const link = linkEl.value.trim();
  const note = noteEl.value.trim();
  
  if (!link) {
    showCustomAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ.');
    return;
  }
  
  const videoId = extractVideoId(link);
  if (!videoId) {
    showCustomAlert('Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡ Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ ØµØ­ÙŠØ­.');
    return;
  }
  
  const videoData = await fetchVideoData(videoId);
  if (!videoData || videoData.error) {
    showCustomAlert('ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ. Ø±Ø¨Ù…Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ Ø®Ø§Øµ.');
    return;
  }
  
  const newVideo = {
    id: genId(),
    type: type,
    url: link,
    videoId: videoId,
    title: videoData.title || 'ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ù…Ø¹Ù†ÙˆÙ†',
    thumbnail: videoData.thumbnail_url || 'https://placehold.co/170x96/cccccc/000000?text=No+Image',
    note: note,
    recorded: false,
    rejected: false
  };
  
  if (!allData[type]) {
    allData[type] = [];
  }
  allData[type].unshift(newVideo);
  
  saveAllToFirebase(); // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  renderAll();
  linkEl.value = '';
  noteEl.value = '';
}

// --- Text Ideas Logic ---

function renderTextIdeas() {
  const ul = document.getElementById('textIdeaList');
  ul.innerHTML = '';
  
  textIdeas.forEach((idea, index) => {
    const li = document.createElement('li');
    li.style.display = 'flex';
    li.style.justifyContent = 'space-between';
    li.style.alignItems = 'center';
    li.style.padding = '8px 0';

    const textSpan = document.createElement('span');
    textSpan.textContent = idea;
    
    const delBtn = document.createElement('button');
    delBtn.textContent = 'Ø­Ø°Ù';
    delBtn.style.cssText = `
        background: #ff3b3b;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 4px 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    `;
    delBtn.onclick = () => deleteTextIdea(index);
    
    li.appendChild(textSpan);
    li.appendChild(delBtn);
    ul.appendChild(li);
  });
}

function saveTextIdea() {
  const inputEl = document.getElementById('textIdea');
  const idea = inputEl.value.trim();
  
  if (idea) {
    textIdeas.unshift(idea);
    saveAllToFirebase(); // Ø­ÙØ¸ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    renderTextIdeas();
    inputEl.value = '';
  } else {
    showCustomAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© ÙÙƒØ±Ø© Ù†ØµÙŠØ© Ù„Ø­ÙØ¸Ù‡Ø§.');
  }
}

function deleteTextIdea(index) {
  // Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… confirm() Ø¨Ù„ Ù†ÙƒØªÙÙŠ Ø¨Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ¦Ø©
  textIdeas.splice(index, 1);
  saveAllToFirebase(); // Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
  renderTextIdeas();
}


// --- Toggles for Video Status ---

function toggleRecorded(id) {
    for (const type in allData) {
        if (!Array.isArray(allData[type])) continue; 
        const index = allData[type].findIndex(v => v.id === id);
        if (index !== -1) {
            const video = allData[type][index];
            video.recorded = !video.recorded;
            video.rejected = false; 
            saveAllToFirebase(); 
            renderAll(); 
            return;
        }
    }
}

function toggleRejected(id) {
    for (const type in allData) {
        if (!Array.isArray(allData[type])) continue; 
        const index = allData[type].findIndex(v => v.id === id);
        if (index !== -1) {
            const video = allData[type][index];
            video.rejected = !video.rejected;
            video.recorded = false; 
            saveAllToFirebase(); 
            renderAll(); 
            return;
        }
    }
}

function deleteVideo(id) {
    // Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… confirm()
    let found = false;
    for (const type in allData) {
        if (!Array.isArray(allData[type])) continue; 
        const initialLength = allData[type].length;
        allData[type] = allData[type].filter(v => v.id !== id);
        if (allData[type].length < initialLength) {
            found = true;
            break;
        }
    }
    if (found) {
        saveAllToFirebase(); 
        renderAll();
    }
}

// --- Dark Mode Logic ---

function toggleNight() {
  document.body.classList.toggle('night');
  localStorage.setItem('nightMode', document.body.classList.contains('night'));
}
</script>
</body>
</html>